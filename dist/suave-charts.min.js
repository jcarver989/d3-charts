var AbstractChart;AbstractChart=function(){return function(b,a,d){null==a&&(a={});null==d&&(d={});this.options=mergeOptions(a,d);this.svg=new Svg(b,this.options.aspectRatio,this.options.margin)}}();var Axes,bind=function(b,a){return function(){return b.apply(a,arguments)}};
Axes=function(){function b(a,d,c,b){this.options=b;this.newAxis=bind(this.newAxis,this);this.xAxisSelection=a.append("g").attr("class","x axis");this.yAxisSelection=a.append("g").attr("class","y axis");this.xAxis=this.newAxis(d,"bottom");this.yAxis=this.newAxis(c,"left")}b.prototype.draw=function(a,d){var c;this.xAxisSelection.attr("transform","translate(0,"+d+")");this.options.grid&&(this.xAxis.tickSize(-d),this.yAxis.tickSize(-a));this.options.xLabelInterval?(c=function(){switch(this.options.xLabelInterval){case "seconds":return d3.time.seconds;
case "minutes":return d3.time.minutes;case "hours":return d3.time.hours;case "days":return d3.time.days;case "months":return d3.time.months;case "years":return d3.time.years}}.call(this),this.xAxis.ticks(c)):null!=this.options.ticks&&0<this.options.ticks&&this.xAxis.ticks(this.options.ticks);this.xAxisSelection.call(this.xAxis);return this.yAxisSelection.call(this.yAxis)};b.prototype.newAxis=function(a,d){return d3.svg.axis().scale(a).orient(d).tickPadding(this.options.tickPadding)};return b}();var BarChart,bind=function(b,a){return function(){return b.apply(a,arguments)}},extend=function(b,a){function d(){this.constructor=b}for(var c in a)hasProp.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty;
BarChart=function(b){function a(d,c){null==c&&(c={});this.render=bind(this.render,this);a.__super__.constructor.call(this,d,defaultBarOptions,c);this.calc=new MarginCalculator(this.svg);this.x=d3.scale.ordinal();this.y=d3.scale.linear();this.xAxis=d3.svg.axis().scale(this.x).orient("bottom");this.yAxis=d3.svg.axis().scale(this.y).orient("left");window.addEventListener("resize",this.render)}extend(a,b);a.prototype.render=function(){this.svg.resize();this.x.rangeRoundBands([0,this.svg.width],.1);this.y.range([this.svg.height,
0]);this.xAxisSelection.attr("transform","translate(0, "+this.svg.height+")").call(this.xAxis);this.yAxisSelection.call(this.yAxis);return this.bars.attr("x",function(a){return function(c){return a.x(c[0])}}(this)).attr("y",function(a){return function(c){return a.y(c[1])}}(this)).attr("width",this.x.rangeBand()).attr("height",function(a){return function(c){return a.svg.height-a.y(c[1])}}(this))};a.prototype.draw=function(a){var c;this.x.domain(a.map(function(a){return a[0]}));this.y.domain([0,d3.max(a,
function(a){return a[1]})]);this.options.margin.left=this.calc.calcLeftMargin(this.yAxis,this.options.margin.left);this.xAxisSelection=this.svg.chart.append("g").attr("class","x axis");this.yAxisSelection=this.svg.chart.append("g").attr("class","y axis");this.bars=this.svg.chart.selectAll(".bar").data(a);this.bars.enter().append("rect").attr("class","bar");c=this.tip||(this.tip=new Tooltip(document));this.bars.on("mouseover",function(a){c.html(a[1]);return c.show(this)});this.bars.on("mouseout",function(a){return c.hide()});
return this.render()};return a}(AbstractChart);var defaultBarOptions,defaultDonutOptions,defaultLineOptions,mergeOptions;mergeOptions=function(b,a){var d,c;c={};for(d in b)c[d]=b[d];for(d in a)c[d]=a[d];return c};defaultLineOptions={xScale:"linear",yScale:"linear",smoothLines:!1,tooltips:!0,aspectRatio:"16:9",tickPadding:10,dotSize:6,grid:!0,xLabelFormat:null,yLabelFormat:null,tooltipFormat:function(b){return d3.format(",.0f")(b)},autoMargins:!0,margin:{top:50,bottom:50,right:80,left:80}};
defaultBarOptions={aspectRatio:"16:9",margin:{top:50,bottom:50,right:80,left:80}};defaultDonutOptions={aspectRatio:"16:9",holeSize:.5,margin:{top:0,bottom:0,right:0,left:0}};var DonutChart,bind=function(b,a){return function(){return b.apply(a,arguments)}},extend=function(b,a){function d(){this.constructor=b}for(var c in a)hasProp.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty;
DonutChart=function(b){function a(d,c){null==c&&(c={});this.draw=bind(this.draw,this);this.render=bind(this.render,this);a.__super__.constructor.call(this,d,defaultDonutOptions,c);this.options.margin={top:0,bottom:0,left:0,right:0};this.arc=d3.svg.arc();this.pie=d3.layout.pie().sort(null).value(function(a){return a[1]});window.addEventListener("resize",this.render)}extend(a,b);a.prototype.render=function(){var a;this.svg.resize();a=Math.min(this.svg.width,this.svg.height)/2;this.svg.chart.attr("transform",
"translate("+this.svg.width/2+", "+this.svg.height/2+")");this.arc.innerRadius(a).outerRadius(a-a*this.options.holeSize);this.arcs.attr("d",this.arc);return this.labels.attr("transform",function(a){return function(d){return"translate("+a.arc.centroid(d)+")"}}(this))};a.prototype.draw=function(a){console.log(a.reduce(function(a,d){return a+d[1]},0));this.enter=this.svg.chart.selectAll(".arc").data(this.pie(a)).enter().append("g").attr("class",function(a,d){return"arc arc-"+d+" arc-"+a.data[0]+"}"});
this.arcs=this.enter.append("path");this.labels=this.enter.append("text").attr("dy",".35em").text(function(a){return a.data[0]});return this.render()};return a}(AbstractChart);var LineChart,bind=function(b,a){return function(){return b.apply(a,arguments)}},extend=function(b,a){function d(){this.constructor=b}for(var c in a)hasProp.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty;
LineChart=function(b){function a(d,c){null==c&&(c={});this.render=bind(this.render,this);a.__super__.constructor.call(this,d,defaultLineOptions,c);this.x=Scales.fromString(this.options.xScale);this.y=Scales.fromString(this.options.yScale);this.axes=new Axes(this.svg.chart,this.x,this.y,this.options);"time"===this.options.xScale&&"string"===typeof this.options.xLabelFormat?this.axes.xAxis.tickFormat(d3.time.format(this.options.xLabelFormat)):this.axes.xAxis.tickFormat(this.options.xLabelFormat);this.axes.yAxis.tickFormat(this.options.yLabelFormat);
this.calc=new MarginCalculator(this.svg);this.line=d3.svg.line();this.area=d3.svg.area();window.addEventListener("resize",this.render)}extend(a,b);a.prototype.enterLines=function(a){return a.append("path").attr("class",function(a){return"line "+a.label})};a.prototype.enterAreas=function(a){return a.filter(function(a){return!0===a.area}).append("path").attr("class",function(a){return"area "+a.label})};a.prototype.createTooltip=function(){var a,c;c=this.tip||(this.tip=new Tooltip(document));a=this.options.tooltipFormat;
this.dots.on("mouseover",function(b){c.html(a(b.value));return c.show(this)});return this.dots.on("mouseout",function(a){return c.hide()})};a.prototype.render=function(){this.svg.resize();this.x.range([0,this.svg.width]);this.y.range([this.svg.height,0]);this.axes.draw(this.svg.width,this.svg.height);this.lines.attr("d",function(a){return function(c){a.line.interpolate(a.chooseInterpolation(c));return a.line(c.values)}}(this));this.area.y0(this.svg.height);this.areas.attr("d",function(a){return function(c){a.area.interpolate(a.chooseInterpolation(c));
return a.area(c.values)}}(this));return this.dots.attr("cx",function(a){return function(c,b){return a.x(a.xLabels[b])}}(this)).attr("cy",function(a){return function(c,b){return a.y(c.value)}}(this))};a.prototype.chooseInterpolation=function(a){return a.smooth?"monotone":"linear"};a.prototype.draw=function(a){var c,b;this.xLabels=a.labels;b=d3.merge(function(){var b,k,g,h;g=a.lines;h=[];b=0;for(k=g.length;b<k;b++)c=g[b],h.push(c.values);return h}());this.x.domain(d3.extent(this.xLabels,function(a){return a})).nice();
this.y.domain([0,d3.max(b,function(a){return a})]).nice();this.line.x(function(a){return function(c,b){return a.x(a.xLabels[b])}}(this)).y(function(a){return function(c){return a.y(c)}}(this));this.area.x(function(a){return function(c,b){return a.x(a.xLabels[b])}}(this)).y(function(a){return function(c){return a.y(c)}}(this));this.options.autoMargins&&(this.options.margin.left=this.calc.calcLeftMargin(this.axes.yAxis,this.options.margin.left));this.lineGroups=this.svg.chart.selectAll(".lineGroup").data(a.lines,
function(a){return a.label});b=this.lineGroups.enter().append("g").attr("class","lineGroup");this.enterLines(b);this.enterAreas(b);this.lines=this.lineGroups.selectAll(".line");this.areas=this.lineGroups.selectAll(".area");this.dotGroups=this.svg.chart.selectAll(".dotGroup").data(a.lines,function(a){return a.label});this.dotGroups.enter().append("g").attr("class","dotGroup");this.dots=this.dotGroups.selectAll(".dot").data(function(a){var c,b,d,e,l;if(!1===a.dots)return[];d=a.values;e=[];c=0;for(b=
d.length;c<b;c++)l=d[c],e.push({value:l,label:a.label});return e});this.dots.enter().append("circle").attr("class",function(a){return"dot "+a.label}).attr("r",this.options.dotSize);this.options.tooltips&&this.createTooltip();return this.render()};return a}(AbstractChart);var MarginCalculator;MarginCalculator=function(){function b(a){this.svg=a}b.prototype.calcLeftMargin=function(a,b,c){var e,f;null==c&&(c=10);f=this.svg.chart.append("g").attr("class","y axis").attr("opacity",0);f.call(a);a=f.selectAll("text").sort(function(a,c){return c-a});b=1<=a.length&&1<=a[0].length?(e=a[0][0].getBBox(),Math.round(e.width)+c):b;f.remove();return b};return b}();var Scales;Scales=function(){function b(){}b.fromString=function(a){switch(a){case "linear":return d3.scale.linear();case "log":return d3.scale.log();case "time":return d3.time.scale();case "ordinal":return d3.scale.ordinal()}};return b}();var ScatterPlot,extend=function(b,a){function d(){this.constructor=b}for(var c in a)hasProp.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty;
ScatterPlot=function(b){function a(b,c){null==c&&(c={});a.__super__.constructor.call(this,b,c)}extend(a,b);a.prototype.draw=function(a){this.x.domain(d3.extent(a,extractX));this.y.domain([0,d3.max(a,extractY)]);this.drawAxes();a=this.svg.selectAll("circle").data(a);a.enter().append("circle").attr("class",function(a){return"circle "+(a.css_class||"")}).attr("r",5).attr("cx",function(a){return function(b){return a.x(extractX(b))}}(this)).attr("cy",function(a){return function(b){return a.y(extractY(b))}}(this));
return a.exit().remove()};return a}(AbstractChart);var Svg;
Svg=function(){function b(a,b,c){this.margin=c;c=b.split(":");b=c[0];c=c[1];this.aspectRatio=[parseInt(b),parseInt(c)];this.domElement=document.querySelector(a);this.container=d3.select(this.domElement).append("svg").attr("preserveAspectRatio","xMinYMin");this.chart=this.container.append("g")}b.prototype.resize=function(a){var b,c;null==a&&(a=this.margin);c=this.domElement.offsetWidth;b=c/this.aspectRatio[0]*this.aspectRatio[1];this.width=c-a.left-a.right;this.height=b-a.bottom-a.top;this.container.attr("width",c).attr("height",
b);return this.chart.attr("transform","translate("+a.left+","+a.top+")")};return b}();var Tooltip,bind=function(b,a){return function(){return b.apply(a,arguments)}};
Tooltip=function(){function b(a){this.hide=bind(this.hide,this);this.show=bind(this.show,this);this.html=bind(this.html,this);this.cssClass="suave-tooltip";this.tip=d3.select(a.createElement("div"));this.tip.attr("class",this.cssClass);a.body.appendChild(this.tip.node())}b.prototype.html=function(a){return this.tip.html(a)};b.prototype.show=function(a){a=this.offset(a);this.tip.attr("class",this.cssClass+" show");return this.tip.style({position:"absolute",top:a.top+"px",left:a.left+"px"})};b.prototype.hide=
function(){return this.tip.attr("class",this.cssClass)};b.prototype.offset=function(a){var b,c;b=a.getBoundingClientRect();a=b.left+(b.right-b.left)/2;c=this.tip.node().getBoundingClientRect();return{top:b.top-(c.bottom-c.top+10)+window.scrollY,left:a-(c.right-c.left)/2+window.scrollX}};return b}();
